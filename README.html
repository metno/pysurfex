<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Python API to SURFEX (pysurfex) &#8212; SURFEX Python API (pysurfex)  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=536c50fe" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css?v=1654e008" />
    
    <script src="_static/documentation_options.js?v=9fa44488"></script>
    <script src="_static/doctools.js?v=695de88e"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">SURFEX Python API (pysurfex)  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python API to SURFEX (pysurfex)</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="python-api-to-surfex-pysurfex">
<h1>Python API to SURFEX (pysurfex)<a class="headerlink" href="#python-api-to-surfex-pysurfex" title="Link to this heading">¶</a></h1>
<dl class="simple">
<dt>An API in python to the external surface model SURFEX.</dt><dd><ul class="simple">
<li><p>Prepare input and namelists to a SURFEX binary</p></li>
<li><p>Create atmospheric forcing for offline SURFEX runs</p></li>
<li><p>Read SURFEX output</p></li>
<li><p>Quality control of observations with titanlib</p></li>
<li><p>Optimal interpolation with gridpp</p></li>
<li><p>Monitor the observations usage</p></li>
</ul>
</dd>
</dl>
<p>See online documentation in <a class="reference external" href="https://metno.github.io/pysurfex/">https://metno.github.io/pysurfex/</a></p>
<section id="installation-of-pregenerated-packages-from-pypi-pip">
<h2>Installation of pregenerated packages from pypi (pip)<a class="headerlink" href="#installation-of-pregenerated-packages-from-pypi-pip" title="Link to this heading">¶</a></h2>
<p>All releases will trigger an autmomatic pre-built package on pypi which can be installed by pip</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3<span class="w"> </span>install<span class="w"> </span>pysurfex
</pre></div>
</div>
<p>User installation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3<span class="w"> </span>install<span class="w"> </span>pysurfex<span class="w"> </span>--user
</pre></div>
</div>
</section>
<section id="run-pysurfex-from-pre-built-container">
<h2>Run pysurfex from pre-built container<a class="headerlink" href="#run-pysurfex-from-pre-built-container" title="Link to this heading">¶</a></h2>
<p>Releases also trigger an update of the pysurfex container in the github container registry. Below is an example to run pgd without any arguments.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>podman<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>ghcr.io/metno/pysurfex:latest<span class="w"> </span>pgd
</pre></div>
</div>
</section>
<section id="installation-on-debian-based-linux-system">
<h2>Installation on debian based Linux system<a class="headerlink" href="#installation-on-debian-based-linux-system" title="Link to this heading">¶</a></h2>
<p>The following depencies are needed. Install the non-standard ones e.g. with pip or your system installation system.</p>
</section>
<section id="general-dependencies-from-pypi">
<h2>General dependencies (from pypi)<a class="headerlink" href="#general-dependencies-from-pypi" title="Link to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>numpy
pyproj
pyyaml
f90nml
</pre></div>
</div>
<p>To read NetCDF files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>NetCDF4
cfunits
</pre></div>
</div>
<p>To read grib files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>eccodes
</pre></div>
</div>
<p>from ECMWF <a class="reference external" href="https://software.ecmwf.int/wiki/display/ECC/Releases">https://software.ecmwf.int/wiki/display/ECC/Releases</a> installed with ENABLE_PYTHON=ON</p>
<p>To read FA files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>falfilfa4py
epygram
</pre></div>
</div>
<p>To plot:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>matplotlib
</pre></div>
</div>
<p>To get observations from frost.met.no API:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>requests
</pre></div>
</div>
<p>For Quality control of observations</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>titanlib
</pre></div>
</div>
<p>For optimal interpolation and observation operators</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gridpp
</pre></div>
</div>
<p>For testing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest
</pre></div>
</div>
</section>
<section id="install-pysurfex">
<h2>Install pysurfex<a class="headerlink" href="#install-pysurfex" title="Link to this heading">¶</a></h2>
<p>An environment manager like miniconda or micromamba is recommended to ensure consistency between the packages.
After installing this you need to set it up for the current session or permanently add it to your shell.
Now it is easy to create a suitable environment for pysurfex. Below is a recipie for micromamba.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install micromamba (linux, https://mamba.readthedocs.io/en/latest/installation/micromamba-installation.html)</span>
<span class="s2">&quot;</span><span class="si">${</span><span class="nv">SHELL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&lt;<span class="o">(</span>curl<span class="w"> </span>-L<span class="w"> </span>micro.mamba.pm/install.sh<span class="o">)</span>

<span class="c1"># specify a installation location for micromamba and add it to your path afterwards. Default it will install in $HOME/.local/bin</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$HOME</span>/.local/bin:<span class="nv">$PATH</span><span class="w">  </span><span class="c1"># Use your PATH</span>

<span class="c1"># initialize your shell (needed in all shells), e.g:</span>
<span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>micromamba<span class="w"> </span>shell<span class="w"> </span>hook<span class="w"> </span>--shell<span class="w"> </span>bash<span class="k">)</span><span class="s2">&quot;</span>

micromamba<span class="w"> </span>create<span class="w"> </span>env<span class="w"> </span>pysurfex
micromamba<span class="w"> </span>activate<span class="w"> </span>pysurfex
micromamba<span class="w"> </span>install<span class="w"> </span><span class="nv">python</span><span class="o">==</span><span class="m">3</span>.12<span class="w"> </span>poetry
</pre></div>
</div>
<p>Download the source code, then install <code class="docutils literal notranslate"><span class="pre">pysurfex</span></code> by executing the following inside the extracted
folder:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>install
</pre></div>
</div>
<p>If not already in a conda/manba environment, this will install <code class="docutils literal notranslate"><span class="pre">pysurfex</span></code> in a poetry environment and this environment can be activated interactively by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>shell
</pre></div>
</div>
<p>or</p>
</section>
<section id="run-pysurfex-client-applications">
<h2>Run pysurfex client applications<a class="headerlink" href="#run-pysurfex-client-applications" title="Link to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span><span class="o">[</span>command<span class="o">]</span>
<span class="c1"># e.g.</span>
poetry<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span><span class="c1"># will run python inside the pysurfex poetry environment</span>
</pre></div>
</div>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h2>
<p>See <a class="reference external" href="https://metno.github.io/pysurfex/#examples">https://metno.github.io/pysurfex/#examples</a></p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Python API to SURFEX (pysurfex)</a><ul>
<li><a class="reference internal" href="#installation-of-pregenerated-packages-from-pypi-pip">Installation of pregenerated packages from pypi (pip)</a></li>
<li><a class="reference internal" href="#run-pysurfex-from-pre-built-container">Run pysurfex from pre-built container</a></li>
<li><a class="reference internal" href="#installation-on-debian-based-linux-system">Installation on debian based Linux system</a></li>
<li><a class="reference internal" href="#general-dependencies-from-pypi">General dependencies (from pypi)</a></li>
<li><a class="reference internal" href="#install-pysurfex">Install pysurfex</a></li>
<li><a class="reference internal" href="#run-pysurfex-client-applications">Run pysurfex client applications</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/README.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">SURFEX Python API (pysurfex)  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python API to SURFEX (pysurfex)</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2020, Trygve Aspelien.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>