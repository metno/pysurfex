
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Examples &#8212; SURFEX Python API (pysurfex)  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">SURFEX Python API (pysurfex)  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Examples</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">¶</a></h1>
<p>First you must install pysurfex and make sure you have it in PYTHONPATH and the bin directory in your path</p>
<p>Example on a Lambert conf proj domain</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;nam_pgd_grid&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;cgrid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CONF PROJ&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;nam_conf_proj&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;xbeta&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;xlat0&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">63.0</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;xlon0&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">15.0</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;xrpk&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.8910065241883678</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;nam_conf_proj_grid&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;nimax&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;njmax&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;xdx&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;xdy&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;xlatcen&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">61.5</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;xloncen&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">9.0</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Example on a system json file</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;ecoclimap_bin_dir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lustre/storeB/users/trygveasp/H2O/open_SURFEX_V8_1/MY_RUN/ECOCLIMAP/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;climdir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lustre/storeB/project/nwp/surfex/PGD/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;oro_dir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lustre/storeB/project/nwp/surfex/PGD/&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="run-open-surfex-8-1">
<h1>Run open-SURFEX 8.1<a class="headerlink" href="#run-open-surfex-8-1" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>Assume pysurfex is installed and in your path</p></li>
<li><p>Assume pysurfex installation directory is “path-to-pysurfex”</p></li>
<li><p>Assume that you have your surfex binaries in PATH and that they are called PGD, PREP, OFFLINE and SODA</p></li>
<li><p>Assume that you have system paths defined in a file called system.json</p></li>
<li><p>Assume a domain defined in a file called domain.json</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir tutorial_open_surfex_8_1
<span class="nb">cd</span> tutorial_open_surfex_8_1

<span class="c1"># Copy example settings (Modify if wanted)</span>
cp path-to-pysurfex/examples/cfg/config_exp_surfex_open_surfex_8_1.toml config_exp_surfex.toml

<span class="c1"># Copy namelist settings (modify if wanted)</span>
cp -r /modules/centos7/user-apps/suv/pysurfex/0.0.1-dev/examples/nam_open_surfex_8_1 nam_open_surfex_8_1

<span class="c1"># Use only one openMP thread</span>
<span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span>

<span class="c1"># Dump environment</span>
dump_environ

<span class="c1"># Create PGD</span>
pgd -c config_exp_surfex.toml -r rte.json --domain domain.json -s system.json -n nam_open_surfex_8_1 -o PGD.nc PGD

<span class="c1"># Create PREP (from namelist values)</span>
prep -c config_exp_surfex.toml -r rte.json --domain domain.json -s system.json -n nam_open_surfex_8_1 --pgd PGD.nc -o PREP.nc --prep_file path-to-pysurfex/test/nam/prep_from_namelist_values.json --prep_filetype json --dtg <span class="m">2021010103</span> PREP

<span class="c1"># Create forcing from 2021010103 to 2021010104 (From MET-Nordic on MET-Norway thredds server)</span>
create_forcing <span class="m">2021010103</span> <span class="m">2021010104</span> -d domain.json -p https://thredds.met.no/thredds/dodsC/metusers/trygveasp/forcing/met_nordic/@YYYY@/@MM@/@DD@//FORCING_@YYYY@@MM@@DD@T@HH@Z.nc --zsoro_converter none -i surfex --rain_converter none --wind_converter none --wind_dir_converter none -ig path-to-pysurfex/0.0.1-dev/examples/domains/met_nordic.json

<span class="c1"># Run Offline</span>
offline -c config_exp_surfex.toml -r rte.json --domain domain.json -s system.json -n nam_open_surfex_8_1 --pgd PGD.nc --prep PREP.nc -o SURFOUT.nc OFFLINE --forcing <span class="nv">$PWD</span>
</pre></div>
</div>
</section>
<section id="run-open-surfex-8-1-on-centos7-ppi">
<h1>Run open-SURFEX 8.1 on centos7 PPI<a class="headerlink" href="#run-open-surfex-8-1-on-centos7-ppi" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>Let us assume that you have your surfex binaries in PATH and that they are called PGD, PREP, OFFLINE and SODA</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load pysurfex</span>
module load Python/3.7.3 gridpp/0.6.0 suv/pysurfex/0.0.1-dev

mkdir tutorial_open_surfex_8_1_ppi
<span class="nb">cd</span> tutorial_open_surfex_8_1_ppi

<span class="c1"># Copy example settings (modify if wanted)</span>
cp /modules/centos7/user-apps/suv/pysurfex/0.0.1-dev/examples/cfg/config_exp_surfex_open_surfex_8_1.toml config_exp_surfex.toml

<span class="c1"># Copy namelist settings (modify if wanted)</span>
cp -r /modules/centos7/user-apps/suv/pysurfex/0.0.1-dev/examples/nam_open_surfex_8_1 nam_open_surfex_8_1

<span class="c1"># Link ppi settings (to make commands shorter)</span>
ln -sf /modules/centos7/user-apps/suv/pysurfex/0.0.1-dev/examples/cfg/ppi_centos7.json ppi.json

<span class="c1"># Create your domain in a file called domain.json</span>

<span class="c1"># Set openMP threads</span>
<span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span>

<span class="c1"># Dump environment</span>
dump_environ

<span class="c1"># Create PGD (Positional argument PGD is the name of your PGD binary)</span>
pgd -c config_exp_surfex.toml -r rte.json --domain domain.json -s ppi.json -n nam_open_surfex_8_1 -o PGD.nc PGD

<span class="c1"># Create PREP (Positional argument PREP is the name of your PREP binary)</span>
prep -c config_exp_surfex.toml -r rte.json --domain domain.json -s ppi.json -n nam_open_surfex_8_1 --pgd PGD.nc -o PREP.nc --prep_file /modules/centos7/user-apps/suv/pysurfex/0.0.1-dev/test/nam/prep_from_namelist_values.json --prep_filetype json --dtg <span class="m">2021010103</span> PREP

<span class="c1"># Create forcing from 2021010103 to 2021010104 (From MET-Nordic on MET-Norway thredds server)</span>
create_forcing <span class="m">2021010103</span> <span class="m">2021010104</span> -d domain.json -p https://thredds.met.no/thredds/dodsC/metusers/trygveasp/forcing/met_nordic/@YYYY@/@MM@/@DD@//FORCING_@YYYY@@MM@@DD@T@HH@Z.nc --zsoro_converter none -i surfex --rain_converter none --wind_converter none --wind_dir_converter none -ig /modules/centos7/user-apps/suv/pysurfex/0.0.1-dev/examples/domains/met_nordic.json

<span class="c1"># Run Offline (Positional argument OFFLINE is the name of your OFFLINE binary)</span>
<span class="c1"># If your domain is different from your forcing you might need to use option --forc_zs</span>
offline -c config_exp_surfex.toml -r rte.json --domain domain.json -s ppi.json -n nam_open_surfex_8_1 --pgd PGD.nc --prep PREP.nc -o SURFOUT.nc OFFLINE --forcing <span class="nv">$PWD</span> --forc_zs
</pre></div>
</div>
</section>
<section id="run-surfex-from-the-module-suv-surfex-cy43-dev-on-ppi-cy43-development-version">
<h1>Run surfex from the module suv/surfex/cy43-dev on PPI (cy43 development version)<a class="headerlink" href="#run-surfex-from-the-module-suv-surfex-cy43-dev-on-ppi-cy43-development-version" title="Permalink to this heading">¶</a></h1>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load modules</span>
module load suv/surfex/cy43-dev Python/3.7.3 gridpp/0.6.0 suv/pysurfex/0.0.1-dev

mkdir tutorial_cy43_dev_ppi
<span class="nb">cd</span> tutorial_cy43_dev_ppi

<span class="c1"># Copy example settings (Modify if wanted)</span>
cp /modules/centos7/user-apps/suv/pysurfex/0.0.1-dev/examples/cfg/config_exp_surfex_cy43_dev_ppi.toml config_exp_surfex.toml

<span class="c1"># Link ppi settings (to make commands shorter)</span>
ln -sf /modules/centos7/user-apps/suv/pysurfex/0.0.1-dev/examples/cfg/ppi_centos7.json ppi.json

<span class="c1"># Use namelists from examples</span>
cp -r /modules/centos7/user-apps/suv/pysurfex/0.0.1-dev/examples/nam_cy43_dev nam_cy43_dev_ppi

<span class="c1"># Modify settings (if wanted)</span>

<span class="c1"># Create your domain in a file called domain.json</span>

<span class="c1"># Set openMP threads</span>
<span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span>

<span class="c1"># Dump environment</span>
dump_environ

<span class="c1"># Create PGD</span>
pgd -c config_exp_surfex.toml -r rte.json --domain domain.json -s ppi.json -n nam_cy43_dev_ppi -o PGD.nc PGD-METNO-centOS-SFX-V8-1-1-OPENMPI-PPI-GFORTRAN-CENTOS-OMP-O2-X0

<span class="c1"># Create PREP</span>
prep -c config_exp_surfex.toml -r rte.json --domain domain.json -s ppi.json -n nam_cy43_dev_ppi --pgd PGD.nc -o PREP.nc --prep_file /modules/centos7/user-apps/suv/pysurfex/0.0.1-dev/test/nam/prep_from_namelist_values.json --prep_filetype json  --dtg <span class="m">2021010103</span> PREP-METNO-centOS-SFX-V8-1-1-OPENMPI-PPI-GFORTRAN-CENTOS-OMP-O2-X0

<span class="c1"># Create forcing from 2021010103 to 2021010104 (From MET-Nordic on MET-Norway thredds server)</span>
create_forcing <span class="m">2021010103</span> <span class="m">2021010104</span> -d domain.json -p https://thredds.met.no/thredds/dodsC/metusers/trygveasp/forcing/met_nordic/@YYYY@/@MM@/@DD@//FORCING_@YYYY@@MM@@DD@T@HH@Z.nc --zsoro_converter none -i surfex --rain_converter none --wind_converter none --wind_dir_converter none -ig /modules/centos7/user-apps/suv/pysurfex/0.0.1-dev/examples/domains/met_nordic.json

<span class="c1"># Run Offline</span>
offline -c config_exp_surfex.toml -r rte.json --domain domain.json -s ppi.json -n nam_cy43_dev_ppi --pgd PGD.nc --prep PREP.nc -o SURFOUT.nc OFFLINE-METNO-centOS-SFX-V8-1-1-OPENMPI-PPI-GFORTRAN-CENTOS-OMP-O2-X0 --forcing <span class="nv">$PWD</span> --forc_zs
</pre></div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Examples</a></li>
<li><a class="reference internal" href="#run-open-surfex-8-1">Run open-SURFEX 8.1</a></li>
<li><a class="reference internal" href="#run-open-surfex-8-1-on-centos7-ppi">Run open-SURFEX 8.1 on centos7 PPI</a></li>
<li><a class="reference internal" href="#run-surfex-from-the-module-suv-surfex-cy43-dev-on-ppi-cy43-development-version">Run surfex from the module suv/surfex/cy43-dev on PPI (cy43 development version)</a></li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/docs/example.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">SURFEX Python API (pysurfex)  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Examples</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Trygve Aspelien.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.1.1.
    </div>
  </body>
</html>