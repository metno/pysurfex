<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pysurfex.cli &#8212; SURFEX Python API (pysurfex)  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=536c50fe" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=1654e008" />
    
    <script src="../../_static/documentation_options.js?v=9fa44488"></script>
    <script src="../../_static/doctools.js?v=695de88e"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SURFEX Python API (pysurfex)  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pysurfex.cli</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pysurfex.cli</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Command line interfaces.&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="n">plt</span> <span class="o">=</span> <span class="kc">None</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">.binary_input</span><span class="w"> </span><span class="kn">import</span> <span class="n">JsonOutputDataFromFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cache</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.cmd_parsing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">parse_args_bufr2json</span><span class="p">,</span>
    <span class="n">parse_args_create_forcing</span><span class="p">,</span>
    <span class="n">parse_args_create_namelist</span><span class="p">,</span>
    <span class="n">parse_args_dump_environ</span><span class="p">,</span>
    <span class="n">parse_args_first_guess_for_oi</span><span class="p">,</span>
    <span class="n">parse_args_gridpp</span><span class="p">,</span>
    <span class="n">parse_args_lsm_file_assim</span><span class="p">,</span>
    <span class="n">parse_args_merge_qc_data</span><span class="p">,</span>
    <span class="n">parse_args_modify_forcing</span><span class="p">,</span>
    <span class="n">parse_args_obs2json</span><span class="p">,</span>
    <span class="n">parse_args_oi2soda</span><span class="p">,</span>
    <span class="n">parse_args_plot_points</span><span class="p">,</span>
    <span class="n">parse_args_qc2obsmon</span><span class="p">,</span>
    <span class="n">parse_args_set_geo_from_obs_set</span><span class="p">,</span>
    <span class="n">parse_args_set_geo_from_stationlist</span><span class="p">,</span>
    <span class="n">parse_args_shape2ign</span><span class="p">,</span>
    <span class="n">parse_args_surfex_binary</span><span class="p">,</span>
    <span class="n">parse_args_titan</span><span class="p">,</span>
    <span class="n">parse_cryoclim_pseudoobs</span><span class="p">,</span>
    <span class="n">parse_sentinel_obs</span><span class="p">,</span>
    <span class="n">parse_set_domain</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.datetime_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">as_datetime</span><span class="p">,</span> <span class="n">as_datetime_args</span><span class="p">,</span> <span class="n">as_timedelta</span><span class="p">,</span> <span class="n">get_decade</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.file</span><span class="w"> </span><span class="kn">import</span> <span class="n">PGDFile</span><span class="p">,</span> <span class="n">PREPFile</span><span class="p">,</span> <span class="n">SURFFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.forcing</span><span class="w"> </span><span class="kn">import</span> <span class="n">modify_forcing</span><span class="p">,</span> <span class="n">run_time_loop</span><span class="p">,</span> <span class="n">set_forcing_config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.geo</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfProjFromHarmonie</span><span class="p">,</span> <span class="n">LonLatVal</span><span class="p">,</span> <span class="n">get_geo_object</span><span class="p">,</span> <span class="n">shape2ign</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.input_methods</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_obsset_file</span><span class="p">,</span> <span class="n">get_datasources</span><span class="p">,</span> <span class="n">set_geo_from_obs_set</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.interpolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">horizontal_oi</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.namelist</span><span class="w"> </span><span class="kn">import</span> <span class="n">NamelistGeneratorAssemble</span><span class="p">,</span> <span class="n">NamelistGeneratorFromNamelistFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.netcdf</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">create_netcdf_first_guess_template</span><span class="p">,</span>
    <span class="n">oi2soda</span><span class="p">,</span>
    <span class="n">read_first_guess_netcdf_file</span><span class="p">,</span>
    <span class="n">write_analysis_netcdf_file</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.obs</span><span class="w"> </span><span class="kn">import</span> <span class="n">StationList</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.obsmon</span><span class="w"> </span><span class="kn">import</span> <span class="n">write_obsmon_sqlite_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.platform_deps</span><span class="w"> </span><span class="kn">import</span> <span class="n">SystemFilePathsFromFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.pseudoobs</span><span class="w"> </span><span class="kn">import</span> <span class="n">CryoclimObservationSet</span><span class="p">,</span> <span class="n">SentinelObservationSet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.read</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConvertedInput</span><span class="p">,</span> <span class="n">Converter</span><span class="p">,</span> <span class="n">get_multi_converters</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.run</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchJob</span><span class="p">,</span> <span class="n">PerturbedOffline</span><span class="p">,</span> <span class="n">SURFEXBinary</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.titan</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">TitanDataSet</span><span class="p">,</span>
    <span class="n">dataset_from_file</span><span class="p">,</span>
    <span class="n">define_quality_control</span><span class="p">,</span>
    <span class="n">merge_json_qc_data_sets</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.variable</span><span class="w"> </span><span class="kn">import</span> <span class="n">Variable</span>


<div class="viewcode-block" id="run_surfex_binary">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.run_surfex_binary">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_surfex_binary</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run a surfex binary.&quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;ARGS: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">masterodb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;masterodb&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">masterodb</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">domain</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;domain&quot;</span><span class="p">)</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandler</span><span class="p">:</span>
            <span class="n">geo</span> <span class="o">=</span> <span class="n">get_geo_object</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fhandler</span><span class="p">))</span>

    <span class="n">system_file_paths</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;system_file_paths&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">system_file_paths</span><span class="p">):</span>
        <span class="n">system_file_paths</span> <span class="o">=</span> <span class="n">SystemFilePathsFromFile</span><span class="p">(</span><span class="n">system_file_paths</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;File not found: &quot;</span> <span class="o">+</span> <span class="n">system_file_paths</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;forcing_dir&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">system_file_paths</span><span class="o">.</span><span class="n">add_system_file_path</span><span class="p">(</span><span class="s2">&quot;forcing_dir&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;forcing_dir&quot;</span><span class="p">])</span>

    <span class="n">do_pgd</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">do_prep</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">do_perturbed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">need_pgd</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">need_prep</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">one_decade</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;one_decade&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">one_decade</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">check_existence</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tolerate_missing&quot;</span><span class="p">):</span>
        <span class="n">check_existence</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">nml_macros</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;macros&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nml_macros</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">nml_macros</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandler</span><span class="p">:</span>
                <span class="n">nml_macros</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fhandler</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">nml_macros</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">prep_input_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;prep_file&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">prep_input_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;prep_file&quot;</span><span class="p">]</span>
    <span class="n">prep_input_pgdfile</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;prep_pgdfile&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">prep_input_pgdfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;prep_pgdfile&quot;</span><span class="p">]</span>

    <span class="n">nml_macros</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;PREP_INPUT_FILE_WITH_PATH&quot;</span><span class="p">:</span> <span class="n">prep_input_file</span><span class="p">,</span>
            <span class="s2">&quot;PREP_PGD_INPUT_FILE_WITH_PATH&quot;</span><span class="p">:</span> <span class="n">prep_input_pgdfile</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># TODO</span>
    <span class="n">perturbed_file_pattern</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">perturbed_file_pattern</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">perturbed_file_pattern</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;perturbed_file_pattern&quot;</span><span class="p">]</span>

    <span class="n">basetime</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;basetime&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;basetime&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;basetime&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">basetime</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;basetime&quot;</span><span class="p">])</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;basetime&quot;</span><span class="p">:</span> <span class="n">basetime</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">basetime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;basetime&quot;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">validtime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;validtime&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">validtime</span> <span class="o">=</span> <span class="n">basetime</span>
    <span class="k">if</span> <span class="n">basetime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xtime</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">basetime</span> <span class="o">-</span> <span class="n">basetime</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">nml_macros</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;PREP_NYEAR&quot;</span><span class="p">:</span> <span class="n">basetime</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                <span class="s2">&quot;PREP_NMONTH&quot;</span><span class="p">:</span> <span class="n">basetime</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                <span class="s2">&quot;PREP_NDAY&quot;</span><span class="p">:</span> <span class="n">basetime</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                <span class="s2">&quot;PREP_XTIME&quot;</span><span class="p">:</span> <span class="n">xtime</span><span class="p">,</span>
                <span class="s2">&quot;SODA_HH&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">basetime</span><span class="o">.</span><span class="n">hour</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">one_decade</span><span class="p">:</span>
            <span class="n">nml_macros</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;DECADE&quot;</span><span class="p">:</span> <span class="n">get_decade</span><span class="p">(</span><span class="n">basetime</span><span class="p">)})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">one_decade</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;You must set basetime with option one_decade&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;prep&quot;</span><span class="p">,</span> <span class="s2">&quot;soda&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You must set basetime when using mode </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;kwargs: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">binary</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">]</span>
    <span class="n">rte</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;rte&quot;</span><span class="p">]</span>
    <span class="n">wrapper</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;wrapper&quot;</span><span class="p">]</span>
    <span class="n">namelist_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;namelist_path&quot;</span><span class="p">]</span>
    <span class="n">force</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;force&quot;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="n">masterodb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;masterodb&quot;</span><span class="p">]</span>
    <span class="n">archive</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;archive&quot;</span><span class="p">]</span>
    <span class="n">only_archive</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;only_archive&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">print_namelist</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;print_namelist&quot;</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;masterodb </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">masterodb</span><span class="p">)</span>

    <span class="n">forc_zs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;forc_zs&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">assemble_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;assemble_file&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">assemble_file</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;pgd&quot;</span><span class="p">:</span>
        <span class="n">do_pgd</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">need_pgd</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">need_prep</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;prep&quot;</span><span class="p">:</span>
        <span class="n">do_prep</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">need_prep</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;offline&quot;</span><span class="p">,</span> <span class="s2">&quot;soda&quot;</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;perturbed&quot;</span><span class="p">:</span>
        <span class="n">do_perturbed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;offline&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">mode</span> <span class="o">+</span> <span class="s2">&quot; is not implemented!&quot;</span><span class="p">)</span>

    <span class="n">pgd_file_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">need_pgd</span><span class="p">:</span>
        <span class="n">pgd_file_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pgd&quot;</span><span class="p">]</span>

    <span class="n">prep_file_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">need_prep</span><span class="p">:</span>
        <span class="n">prep_file_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;prep&quot;</span><span class="p">]</span>

    <span class="n">pert</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;pert&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">pert</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pert&quot;</span><span class="p">]</span>
    <span class="n">negpert</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s2">&quot;negpert&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">negpert</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;negpert&quot;</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">basetime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;basetime&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">basetime</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">basetime</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">basetime</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">basetime</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">input_binary_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;input_binary_data&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">input_binary_data</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Create run time enviroment from local unless given</span>
    <span class="k">if</span> <span class="n">rte</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rte</span> <span class="o">=</span> <span class="s2">&quot;rte.json&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">rte</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rte</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandler</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">fhandler</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rte</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
        <span class="n">rte</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
        <span class="n">my_batch</span> <span class="o">=</span> <span class="n">BatchJob</span><span class="p">(</span><span class="n">rte</span><span class="p">,</span> <span class="n">wrapper</span><span class="o">=</span><span class="n">wrapper</span><span class="p">)</span>

    <span class="n">my_archive</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">archive</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">archive</span><span class="p">):</span>
            <span class="n">my_archive</span> <span class="o">=</span> <span class="n">JsonOutputDataFromFile</span><span class="p">(</span><span class="n">archive</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;File not found: &quot;</span> <span class="o">+</span> <span class="n">archive</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;nml_macros: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">nml_macros</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output</span><span class="p">))</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">assemble_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nam_gen</span> <span class="o">=</span> <span class="n">NamelistGeneratorFromNamelistFile</span><span class="p">(</span>
                <span class="n">mode</span><span class="p">,</span> <span class="n">namelist_path</span><span class="p">,</span> <span class="n">macros</span><span class="o">=</span><span class="n">nml_macros</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">namelist_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
                <span class="n">nam_defs</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">assemble_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
                <span class="n">assemble</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
            <span class="n">nam_gen</span> <span class="o">=</span> <span class="n">NamelistGeneratorAssemble</span><span class="p">(</span>
                <span class="n">mode</span><span class="p">,</span> <span class="n">nam_defs</span><span class="p">,</span> <span class="n">assemble</span><span class="p">,</span> <span class="n">macros</span><span class="o">=</span><span class="n">nml_macros</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;pgd&quot;</span><span class="p">:</span>
            <span class="n">nam_gen</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">update_namelist</span><span class="p">(</span><span class="n">nam_gen</span><span class="p">)</span>
        <span class="n">my_settings</span> <span class="o">=</span> <span class="n">nam_gen</span><span class="o">.</span><span class="n">get_namelist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;pgd&quot;</span> <span class="ow">and</span> <span class="n">one_decade</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ntime</span> <span class="o">=</span> <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_data_isba&quot;</span><span class="p">][</span><span class="s2">&quot;ntime&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ntime</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Overriding value </span><span class="si">%s</span><span class="s2"> nam_data_isba#ntime and setting it 1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;because of one_decade=True&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_data_isba&quot;</span><span class="p">][</span><span class="s2">&quot;ntime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">KeyError</span>
        <span class="k">if</span> <span class="n">forc_zs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_io_offline&quot;</span><span class="p">][</span><span class="s2">&quot;lset_forc_zs&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Override lset_forc_zs with value True&quot;</span><span class="p">)</span>
            <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_io_offline&quot;</span><span class="p">][</span><span class="s2">&quot;lset_forc_zs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
            <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_io_offline&quot;</span><span class="p">][</span><span class="s2">&quot;xtstep_output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output_frequency&quot;</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
            <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_var&quot;</span><span class="p">][</span><span class="s2">&quot;nvar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_var&quot;</span><span class="p">][</span><span class="s2">&quot;nncv&quot;</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">nnco</span> <span class="o">=</span> <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_obs&quot;</span><span class="p">][</span><span class="s2">&quot;nnco&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">nnco</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">nnco</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nobstype</span> <span class="o">=</span> <span class="n">nnco</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nnco</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">nnco</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nobstype_old</span> <span class="o">=</span> <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_obs&quot;</span><span class="p">][</span><span class="s2">&quot;nobstype&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">nobstype_old</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">nobstype_old</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nobstype_old</span> <span class="o">!=</span> <span class="n">nobstype</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Mismatch in nobstype. Override </span><span class="si">%s</span><span class="s2"> with: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">nobstype_old</span><span class="p">,</span> <span class="n">nobstype</span>
                <span class="p">)</span>
            <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_obs&quot;</span><span class="p">][</span><span class="s2">&quot;nobstype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nobstype</span>

        <span class="k">if</span> <span class="n">input_binary_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;input_binary_data not set&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_binary_data</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
            <span class="n">input_binary_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>

        <span class="n">input_data</span> <span class="o">=</span> <span class="n">nam_gen</span><span class="o">.</span><span class="n">input_data_from_namelist</span><span class="p">(</span>
            <span class="n">input_binary_data</span><span class="p">,</span>
            <span class="n">system_file_paths</span><span class="p">,</span>
            <span class="n">validtime</span><span class="o">=</span><span class="n">validtime</span><span class="p">,</span>
            <span class="n">basetime</span><span class="o">=</span><span class="n">basetime</span><span class="p">,</span>
            <span class="n">check_existence</span><span class="o">=</span><span class="n">check_existence</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Create input</span>
        <span class="n">my_format</span> <span class="o">=</span> <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_io_offline&quot;</span><span class="p">][</span><span class="s2">&quot;csurf_filetype&quot;</span><span class="p">]</span>
        <span class="n">my_pgdfile</span> <span class="o">=</span> <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_io_offline&quot;</span><span class="p">][</span><span class="s2">&quot;cpgdfile&quot;</span><span class="p">]</span>
        <span class="n">my_prepfile</span> <span class="o">=</span> <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_io_offline&quot;</span><span class="p">][</span><span class="s2">&quot;cprepfile&quot;</span><span class="p">]</span>
        <span class="n">my_surffile</span> <span class="o">=</span> <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_io_offline&quot;</span><span class="p">][</span><span class="s2">&quot;csurffile&quot;</span><span class="p">]</span>
        <span class="n">lfagmap</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;lfagmap&quot;</span> <span class="ow">in</span> <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_io_offline&quot;</span><span class="p">]:</span>
            <span class="n">lfagmap</span> <span class="o">=</span> <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_io_offline&quot;</span><span class="p">][</span><span class="s2">&quot;lfagmap&quot;</span><span class="p">]</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;pgdfile=</span><span class="si">%s</span><span class="s2"> lfagmap=</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">my_pgdfile</span><span class="p">,</span> <span class="n">lfagmap</span><span class="p">,</span> <span class="n">pgd_file_path</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;nam_io_offline=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">my_settings</span><span class="p">[</span><span class="s2">&quot;nam_io_offline&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_archive</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">need_pgd</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Need pgd&quot;</span><span class="p">)</span>
                <span class="n">my_pgdfile</span> <span class="o">=</span> <span class="n">PGDFile</span><span class="p">(</span>
                    <span class="n">my_format</span><span class="p">,</span>
                    <span class="n">my_pgdfile</span><span class="p">,</span>
                    <span class="n">input_file</span><span class="o">=</span><span class="n">pgd_file_path</span><span class="p">,</span>
                    <span class="n">lfagmap</span><span class="o">=</span><span class="n">lfagmap</span><span class="p">,</span>
                    <span class="n">masterodb</span><span class="o">=</span><span class="n">masterodb</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">need_prep</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Need prep&quot;</span><span class="p">)</span>
                <span class="n">my_prepfile</span> <span class="o">=</span> <span class="n">PREPFile</span><span class="p">(</span>
                    <span class="n">my_format</span><span class="p">,</span>
                    <span class="n">my_prepfile</span><span class="p">,</span>
                    <span class="n">input_file</span><span class="o">=</span><span class="n">prep_file_path</span><span class="p">,</span>
                    <span class="n">lfagmap</span><span class="o">=</span><span class="n">lfagmap</span><span class="p">,</span>
                    <span class="n">masterodb</span><span class="o">=</span><span class="n">masterodb</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">surffile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">need_prep</span> <span class="ow">and</span> <span class="n">need_pgd</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Need pgd and prep&quot;</span><span class="p">)</span>
                <span class="n">surffile</span> <span class="o">=</span> <span class="n">SURFFile</span><span class="p">(</span>
                    <span class="n">my_format</span><span class="p">,</span>
                    <span class="n">my_surffile</span><span class="p">,</span>
                    <span class="n">archive_file</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
                    <span class="n">lfagmap</span><span class="o">=</span><span class="n">lfagmap</span><span class="p">,</span>
                    <span class="n">masterodb</span><span class="o">=</span><span class="n">masterodb</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">do_perturbed</span><span class="p">:</span>
                <span class="n">PerturbedOffline</span><span class="p">(</span>
                    <span class="n">binary</span><span class="p">,</span>
                    <span class="n">my_batch</span><span class="p">,</span>
                    <span class="n">my_prepfile</span><span class="p">,</span>
                    <span class="n">pert</span><span class="p">,</span>
                    <span class="n">my_settings</span><span class="p">,</span>
                    <span class="n">input_data</span><span class="p">,</span>
                    <span class="n">pgdfile</span><span class="o">=</span><span class="n">my_pgdfile</span><span class="p">,</span>
                    <span class="n">surfout</span><span class="o">=</span><span class="n">surffile</span><span class="p">,</span>
                    <span class="n">archive_data</span><span class="o">=</span><span class="n">my_archive</span><span class="p">,</span>
                    <span class="n">print_namelist</span><span class="o">=</span><span class="n">print_namelist</span><span class="p">,</span>
                    <span class="n">negpert</span><span class="o">=</span><span class="n">negpert</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">do_pgd</span><span class="p">:</span>
                <span class="n">my_pgdfile</span> <span class="o">=</span> <span class="n">PGDFile</span><span class="p">(</span>
                    <span class="n">my_format</span><span class="p">,</span>
                    <span class="n">my_pgdfile</span><span class="p">,</span>
                    <span class="n">input_file</span><span class="o">=</span><span class="n">pgd_file_path</span><span class="p">,</span>
                    <span class="n">archive_file</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
                    <span class="n">lfagmap</span><span class="o">=</span><span class="n">lfagmap</span><span class="p">,</span>
                    <span class="n">masterodb</span><span class="o">=</span><span class="n">masterodb</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">SURFEXBinary</span><span class="p">(</span>
                    <span class="n">binary</span><span class="p">,</span>
                    <span class="n">my_batch</span><span class="p">,</span>
                    <span class="n">my_pgdfile</span><span class="p">,</span>
                    <span class="n">my_settings</span><span class="p">,</span>
                    <span class="n">input_data</span><span class="p">,</span>
                    <span class="n">archive_data</span><span class="o">=</span><span class="n">my_archive</span><span class="p">,</span>
                    <span class="n">print_namelist</span><span class="o">=</span><span class="n">print_namelist</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">do_prep</span><span class="p">:</span>
                <span class="n">my_prepfile</span> <span class="o">=</span> <span class="n">PREPFile</span><span class="p">(</span>
                    <span class="n">my_format</span><span class="p">,</span>
                    <span class="n">my_prepfile</span><span class="p">,</span>
                    <span class="n">archive_file</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
                    <span class="n">lfagmap</span><span class="o">=</span><span class="n">lfagmap</span><span class="p">,</span>
                    <span class="n">masterodb</span><span class="o">=</span><span class="n">masterodb</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">SURFEXBinary</span><span class="p">(</span>
                    <span class="n">binary</span><span class="p">,</span>
                    <span class="n">my_batch</span><span class="p">,</span>
                    <span class="n">my_prepfile</span><span class="p">,</span>
                    <span class="n">my_settings</span><span class="p">,</span>
                    <span class="n">input_data</span><span class="p">,</span>
                    <span class="n">pgdfile</span><span class="o">=</span><span class="n">my_pgdfile</span><span class="p">,</span>
                    <span class="n">archive_data</span><span class="o">=</span><span class="n">my_archive</span><span class="p">,</span>
                    <span class="n">print_namelist</span><span class="o">=</span><span class="n">print_namelist</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">SURFEXBinary</span><span class="p">(</span>
                    <span class="n">binary</span><span class="p">,</span>
                    <span class="n">my_batch</span><span class="p">,</span>
                    <span class="n">my_prepfile</span><span class="p">,</span>
                    <span class="n">my_settings</span><span class="p">,</span>
                    <span class="n">input_data</span><span class="p">,</span>
                    <span class="n">pgdfile</span><span class="o">=</span><span class="n">my_pgdfile</span><span class="p">,</span>
                    <span class="n">surfout</span><span class="o">=</span><span class="n">surffile</span><span class="p">,</span>
                    <span class="n">archive_data</span><span class="o">=</span><span class="n">my_archive</span><span class="p">,</span>
                    <span class="n">print_namelist</span><span class="o">=</span><span class="n">print_namelist</span><span class="p">,</span>
                <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> already exists!&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span></div>



<div class="viewcode-block" id="run_gridpp">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.run_gridpp">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_gridpp</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gridpp.&quot;&quot;&quot;</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">]</span>
    <span class="n">input_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;input_file&quot;</span><span class="p">]</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;output_file&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output_file&quot;</span><span class="p">]</span>
    <span class="n">hlength</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;hlength&quot;</span><span class="p">]</span>
    <span class="n">vlength</span> <span class="o">=</span> <span class="mi">100000</span>
    <span class="k">if</span> <span class="s2">&quot;vlength&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vlength</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;vlength&quot;</span><span class="p">]</span>
    <span class="n">wlength</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s2">&quot;wlength&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">wlength</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;wlength&quot;</span><span class="p">]</span>
    <span class="n">max_locations</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="k">if</span> <span class="s2">&quot;max_locations&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">max_locations</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;max_locations&quot;</span><span class="p">]</span>
    <span class="n">elev_gradient</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s2">&quot;elev_gradient&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">elev_gradient</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;elev_gradient&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">elev_gradient</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.0065</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Not a valid elevation gradient&quot;</span><span class="p">)</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;epsilon&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;epsilon&quot;</span><span class="p">]</span>
    <span class="n">minvalue</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;minvalue&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">minvalue</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;minvalue&quot;</span><span class="p">]</span>
    <span class="n">maxvalue</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;maxvalue&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">maxvalue</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;maxvalue&quot;</span><span class="p">]</span>
    <span class="n">only_diff</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s2">&quot;only_diff&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">only_diff</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;only_diff&quot;</span><span class="p">]</span>
    <span class="n">obs_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;obs_file&quot;</span><span class="p">]</span>

    <span class="c1"># Get input fields</span>
    <span class="n">geo</span><span class="p">,</span> <span class="n">validtime</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="n">glafs</span><span class="p">,</span> <span class="n">gelevs</span> <span class="o">=</span> <span class="n">read_first_guess_netcdf_file</span><span class="p">(</span>
        <span class="n">input_file</span><span class="p">,</span> <span class="n">var</span>
    <span class="p">)</span>

    <span class="n">an_time</span> <span class="o">=</span> <span class="n">validtime</span>
    <span class="c1"># Read OK observations</span>
    <span class="n">observations</span> <span class="o">=</span> <span class="n">dataset_from_file</span><span class="p">(</span><span class="n">an_time</span><span class="p">,</span> <span class="n">obs_file</span><span class="p">,</span> <span class="n">qc_flag</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%s</span><span class="s2"> observations with QC flag == 0&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">observations</span><span class="o">.</span><span class="n">lons</span><span class="p">)))</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">horizontal_oi</span><span class="p">(</span>
        <span class="n">geo</span><span class="p">,</span>
        <span class="n">background</span><span class="p">,</span>
        <span class="n">observations</span><span class="p">,</span>
        <span class="n">gelevs</span><span class="p">,</span>
        <span class="n">hlength</span><span class="o">=</span><span class="n">hlength</span><span class="p">,</span>
        <span class="n">vlength</span><span class="o">=</span><span class="n">vlength</span><span class="p">,</span>
        <span class="n">wlength</span><span class="o">=</span><span class="n">wlength</span><span class="p">,</span>
        <span class="n">structure_function</span><span class="o">=</span><span class="s2">&quot;Barnes&quot;</span><span class="p">,</span>
        <span class="n">max_locations</span><span class="o">=</span><span class="n">max_locations</span><span class="p">,</span>
        <span class="n">elev_gradient</span><span class="o">=</span><span class="n">elev_gradient</span><span class="p">,</span>
        <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">,</span>
        <span class="n">minvalue</span><span class="o">=</span><span class="n">minvalue</span><span class="p">,</span>
        <span class="n">maxvalue</span><span class="o">=</span><span class="n">maxvalue</span><span class="p">,</span>
        <span class="n">interpol</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
        <span class="n">only_diff</span><span class="o">=</span><span class="n">only_diff</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">write_analysis_netcdf_file</span><span class="p">(</span>
            <span class="n">output_file</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">validtime</span><span class="p">,</span> <span class="n">gelevs</span><span class="p">,</span> <span class="n">glafs</span><span class="p">,</span> <span class="n">new_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">geo</span><span class="o">=</span><span class="n">geo</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="run_titan">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.run_titan">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_titan</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Titan.&quot;&quot;&quot;</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;domain&quot;</span><span class="p">)</span>
    <span class="n">domain_geo</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandler</span><span class="p">:</span>
            <span class="n">domain_geo</span> <span class="o">=</span> <span class="n">get_geo_object</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fhandler</span><span class="p">))</span>

    <span class="n">blacklist</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;blacklist&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">blacklist</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;blacklist&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s2">&quot;blacklist_file&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;blacklist_file&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;blacklist_file&quot;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandler</span><span class="p">:</span>
            <span class="n">blacklist</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fhandler</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;input_file&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">input_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;input_file&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_file</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandler</span><span class="p">:</span>
                <span class="n">settings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fhandler</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Could not find input file &quot;</span> <span class="o">+</span> <span class="n">input_file</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;input_data&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;input_data&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;You must specify input_file or input_data&quot;</span><span class="p">)</span>

    <span class="n">tests</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;output_file&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output_file&quot;</span><span class="p">]</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;indent&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;indent&quot;</span><span class="p">]</span>

    <span class="n">an_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;validtime&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">an_time</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">an_time</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">an_time</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span>

    <span class="n">tests</span> <span class="o">=</span> <span class="n">define_quality_control</span><span class="p">(</span>
        <span class="n">tests</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">an_time</span><span class="p">,</span> <span class="n">domain_geo</span><span class="o">=</span><span class="n">domain_geo</span><span class="p">,</span> <span class="n">blacklist</span><span class="o">=</span><span class="n">blacklist</span>
    <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Settings: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
    <span class="n">datasources</span> <span class="o">=</span> <span class="n">get_datasources</span><span class="p">(</span><span class="n">an_time</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s2">&quot;sets&quot;</span><span class="p">])</span>
    <span class="n">data_set</span> <span class="o">=</span> <span class="n">TitanDataSet</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">tests</span><span class="p">,</span> <span class="n">datasources</span><span class="p">,</span> <span class="n">an_time</span><span class="p">)</span>
    <span class="n">data_set</span><span class="o">.</span><span class="n">perform_tests</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_set</span><span class="o">.</span><span class="n">write_output</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span></div>



<div class="viewcode-block" id="run_oi2soda">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.run_oi2soda">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_oi2soda</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Oi2soda.&quot;&quot;&quot;</span>
    <span class="n">t2m_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;t2m_file&quot;</span><span class="p">]</span>
    <span class="n">rh2m_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;rh2m_file&quot;</span><span class="p">]</span>
    <span class="n">sd_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;sd_file&quot;</span><span class="p">]</span>
    <span class="n">sm_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;sm_file&quot;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>

    <span class="n">t2m</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">t2m_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">t2m</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">t2m_file</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;t2m_var&quot;</span><span class="p">]}</span>
    <span class="n">rh2m</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">rh2m_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rh2m</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">rh2m_file</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;rh2m_var&quot;</span><span class="p">]}</span>
    <span class="n">s_d</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">sd_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s_d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">sd_file</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;sd_var&quot;</span><span class="p">]}</span>
    <span class="n">s_m</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">sm_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s_m</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">sm_file</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;sm_var&quot;</span><span class="p">]}</span>

    <span class="n">basetime</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;basetime&quot;</span><span class="p">])</span>
    <span class="n">oi2soda</span><span class="p">(</span><span class="n">basetime</span><span class="p">,</span> <span class="n">t2m</span><span class="o">=</span><span class="n">t2m</span><span class="p">,</span> <span class="n">rh2m</span><span class="o">=</span><span class="n">rh2m</span><span class="p">,</span> <span class="n">s_d</span><span class="o">=</span><span class="n">s_d</span><span class="p">,</span> <span class="n">s_m</span><span class="o">=</span><span class="n">s_m</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span></div>



<div class="viewcode-block" id="set_geo_from_stationlist">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.set_geo_from_stationlist">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_geo_from_stationlist</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set geometry from station list.&quot;&quot;&quot;</span>
    <span class="n">stationlist</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;stationlist&quot;</span><span class="p">]</span>
    <span class="n">lonrange</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;lonrange&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;lonrange&quot;</span><span class="p">]</span>
    <span class="n">latrange</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;latrange&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">latrange</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;latrange&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">lonrange</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">latrange</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">latrange</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>

    <span class="n">lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stationlist</span> <span class="o">=</span> <span class="n">StationList</span><span class="p">(</span><span class="n">stationlist</span><span class="p">)</span>
    <span class="n">stids</span> <span class="o">=</span> <span class="n">stationlist</span><span class="o">.</span><span class="n">stids</span>

    <span class="k">for</span> <span class="n">stid</span> <span class="ow">in</span> <span class="n">stids</span><span class="p">:</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="n">stationlist</span><span class="o">.</span><span class="n">get_pos_from_stid</span><span class="p">([</span><span class="n">stid</span><span class="p">])</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lonrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">lon</span> <span class="o">&lt;=</span> <span class="n">lonrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">latrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">latrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

    <span class="n">d_x</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;0.3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
    <span class="n">geo_json</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;nam_pgd_grid&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;cgrid&quot;</span><span class="p">:</span> <span class="s2">&quot;LONLATVAL&quot;</span><span class="p">},</span>
        <span class="s2">&quot;nam_lonlatval&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;xx&quot;</span><span class="p">:</span> <span class="n">lons</span><span class="p">,</span> <span class="s2">&quot;xy&quot;</span><span class="p">:</span> <span class="n">lats</span><span class="p">,</span> <span class="s2">&quot;xdx&quot;</span><span class="p">:</span> <span class="n">d_x</span><span class="p">,</span> <span class="s2">&quot;xdy&quot;</span><span class="p">:</span> <span class="n">d_x</span><span class="p">},</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">LonLatVal</span><span class="p">(</span><span class="n">geo_json</span><span class="p">)</span></div>



<div class="viewcode-block" id="sentinel_obs">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.sentinel_obs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sentinel_obs</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_sentinel_obs</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ sentinel_obs ******************&quot;</span><span class="p">)</span>
    <span class="n">fg_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;fg_file&quot;</span><span class="p">]</span>
    <span class="n">infiles</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;infiles&quot;</span><span class="p">]</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;thinning&quot;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="n">varname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;varname&quot;</span><span class="p">]</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;indent&quot;</span><span class="p">]</span>

    <span class="n">fg_geo</span><span class="p">,</span> <span class="n">validtime</span><span class="p">,</span> <span class="n">grid_sm_fg</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="n">read_first_guess_netcdf_file</span><span class="p">(</span><span class="n">fg_file</span><span class="p">,</span> <span class="n">varname</span><span class="p">)</span>
    <span class="n">obs_set</span> <span class="o">=</span> <span class="n">SentinelObservationSet</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">validtime</span><span class="p">,</span> <span class="n">fg_geo</span><span class="p">,</span> <span class="n">grid_sm_fg</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
    <span class="n">obs_set</span><span class="o">.</span><span class="n">write_json_file</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span></div>



<div class="viewcode-block" id="qc2obsmon">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.qc2obsmon">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">qc2obsmon</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_qc2obsmon</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ qc2obsmon ******************&quot;</span><span class="p">)</span>
    <span class="n">write_obsmon_sqlite_file</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="prep">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.prep">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">prep</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_surfex_binary</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="s2">&quot;prep&quot;</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ prep ******************&quot;</span><span class="p">)</span>
    <span class="n">run_surfex_binary</span><span class="p">(</span><span class="s2">&quot;prep&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="plot_points">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.plot_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_points</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: &quot;Inputype is not implemented&quot;</span>
<span class="sd">        RuntimeError: &quot;No geo is set&quot;</span>
<span class="sd">        RuntimeError: &quot;No field read&quot;</span>
<span class="sd">        ModuleNotFoundError: &quot;Matplotlib is needed to plot&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">parser</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_plot_points</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ plot_points ******************&quot;</span><span class="p">)</span>

    <span class="n">validtime</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;validtime&quot;</span><span class="p">])</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>

    <span class="n">geo_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;geo&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">geo_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;geo&quot;</span><span class="p">]</span>

    <span class="n">geo</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">geo_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">geo_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandler</span><span class="p">:</span>
            <span class="n">domain_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fhandler</span><span class="p">)</span>
        <span class="n">geo</span> <span class="o">=</span> <span class="n">get_geo_object</span><span class="p">(</span><span class="n">domain_json</span><span class="p">)</span>

    <span class="n">contour</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="s2">&quot;no_contour&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">no_contour</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;no_contour&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">no_contour</span><span class="p">:</span>
            <span class="n">contour</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">converter</span> <span class="o">=</span> <span class="n">get_multi_converters</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="p">[],</span> <span class="n">argv</span><span class="p">)</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">ConvertedInput</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="n">converter</span><span class="p">)</span><span class="o">.</span><span class="n">read_time_step</span><span class="p">(</span><span class="n">validtime</span><span class="p">,</span> <span class="n">cache</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No field read&quot;</span><span class="p">)</span>

    <span class="n">converter_name</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">name</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;converter=</span><span class="si">{</span><span class="n">converter_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">geo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No geo is set&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No field read&quot;</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;npoints=</span><span class="si">%s</span><span class="s2"> nlons=</span><span class="si">%s</span><span class="s2"> nlats=</span><span class="si">%s</span><span class="s2"> contour=</span><span class="si">%s</span><span class="s2"> field.shape=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">npoints</span><span class="p">,</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">nlons</span><span class="p">,</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">nlats</span><span class="p">,</span>
        <span class="n">contour</span><span class="p">,</span>
        <span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">geo</span><span class="o">.</span><span class="n">npoints</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">nlons</span><span class="p">,</span> <span class="n">geo</span><span class="o">.</span><span class="n">nlats</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">contour</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="p">[</span><span class="n">geo</span><span class="o">.</span><span class="n">nlons</span><span class="p">,</span> <span class="n">geo</span><span class="o">.</span><span class="n">nlats</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">contour</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">plt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ModuleNotFoundError</span><span class="p">(</span><span class="s2">&quot;Matplotlib is needed to plot&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;lons.shape=</span><span class="si">%s</span><span class="s2"> lats.shape=</span><span class="si">%s</span><span class="s2"> field.shape=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">lons</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">lats</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
        <span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">contour</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">lons</span><span class="p">,</span> <span class="n">geo</span><span class="o">.</span><span class="n">lats</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">lonlist</span><span class="p">,</span> <span class="n">geo</span><span class="o">.</span><span class="n">latlist</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">field</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saving figure in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></div>



<div class="viewcode-block" id="pgd">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.pgd">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pgd</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_surfex_binary</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="s2">&quot;pgd&quot;</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ pgd ******************&quot;</span><span class="p">)</span>
    <span class="n">run_surfex_binary</span><span class="p">(</span><span class="s2">&quot;pgd&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="perturbed_offline">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.perturbed_offline">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">perturbed_offline</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_surfex_binary</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="s2">&quot;perturbed&quot;</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ perturbed ******************&quot;</span><span class="p">)</span>
    <span class="n">run_surfex_binary</span><span class="p">(</span><span class="s2">&quot;perturbed&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="offline">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.offline">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">offline</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_surfex_binary</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="s2">&quot;offline&quot;</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ offline ******************&quot;</span><span class="p">)</span>
    <span class="n">run_surfex_binary</span><span class="p">(</span><span class="s2">&quot;offline&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="cli_oi2soda">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.cli_oi2soda">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cli_oi2soda</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_oi2soda</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ oi2soda ******************&quot;</span><span class="p">)</span>
    <span class="n">run_oi2soda</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="cli_modify_forcing">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.cli_modify_forcing">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cli_modify_forcing</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_modify_forcing</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ modify_forcing ******************&quot;</span><span class="p">)</span>
    <span class="n">modify_forcing</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="cli_merge_qc_data">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.cli_merge_qc_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cli_merge_qc_data</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_merge_qc_data</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ merge_qc_data ******************&quot;</span><span class="p">)</span>

    <span class="n">qc_data</span> <span class="o">=</span> <span class="n">merge_json_qc_data_sets</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;validtime&quot;</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filenames&quot;</span><span class="p">))</span>
    <span class="n">qc_data</span><span class="o">.</span><span class="n">write_output</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indent&quot;</span><span class="p">))</span></div>



<div class="viewcode-block" id="gridpp">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.gridpp">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gridpp</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_gridpp</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ gridpp ******************&quot;</span><span class="p">)</span>
    <span class="n">run_gridpp</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="dump_environ">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.dump_environ">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dump_environ</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_dump_environ</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">outputfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;outputfile&quot;</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputfile</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">file_handler</span><span class="p">)</span></div>



<div class="viewcode-block" id="first_guess_for_oi">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.first_guess_for_oi">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">first_guess_for_oi</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;First guess for OI.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv (list): Arguments</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">parser</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_first_guess_for_oi</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>

    <span class="n">domain</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;domain&quot;</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandler</span><span class="p">:</span>
        <span class="n">geo</span> <span class="o">=</span> <span class="n">get_geo_object</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fhandler</span><span class="p">))</span>

    <span class="n">validtime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;validtime&quot;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="n">fg_variables</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;fg_variables&quot;</span><span class="p">]</span>

    <span class="n">fvariables</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fg_var</span> <span class="ow">in</span> <span class="n">fg_variables</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">outvar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fg_var</span><span class="si">}</span><span class="s2">_outfile_var&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Set output var equal to fg_var </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fg_var</span><span class="p">)</span>
            <span class="n">outvar</span> <span class="o">=</span> <span class="n">fg_var</span>
        <span class="n">fvariables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outvar</span><span class="p">)</span>
    <span class="n">validtime</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">validtime</span><span class="p">)</span>

    <span class="n">converters</span> <span class="o">=</span> <span class="n">get_multi_converters</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">fg_variables</span><span class="p">,</span> <span class="n">argv</span><span class="p">)</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span>

    <span class="n">f_g</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">fg_var</span> <span class="ow">in</span> <span class="n">fg_variables</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fg_var</span><span class="si">}</span><span class="s2">_outfile_var&quot;</span><span class="p">]</span>
        <span class="n">converter</span> <span class="o">=</span> <span class="n">converters</span><span class="p">[</span><span class="n">fg_var</span><span class="p">]</span>

        <span class="n">field</span> <span class="o">=</span> <span class="n">ConvertedInput</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="n">fg_var</span><span class="p">,</span> <span class="n">converter</span><span class="p">)</span><span class="o">.</span><span class="n">read_time_step</span><span class="p">(</span><span class="n">validtime</span><span class="p">,</span> <span class="n">cache</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="p">[</span><span class="n">geo</span><span class="o">.</span><span class="n">nlons</span><span class="p">,</span> <span class="n">geo</span><span class="o">.</span><span class="n">nlats</span><span class="p">])</span>

        <span class="c1"># Create file</span>
        <span class="k">if</span> <span class="n">f_g</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_x</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">nlons</span>
            <span class="n">n_y</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">nlats</span>
            <span class="n">f_g</span> <span class="o">=</span> <span class="n">create_netcdf_first_guess_template</span><span class="p">(</span>
                <span class="n">fvariables</span><span class="p">,</span> <span class="n">n_x</span><span class="p">,</span> <span class="n">n_y</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">geo</span><span class="o">=</span><span class="n">geo</span>
            <span class="p">)</span>
            <span class="n">epoch</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                <span class="p">(</span><span class="n">validtime</span> <span class="o">-</span> <span class="n">as_datetime_args</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">1970</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">f_g</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">epoch</span>
            <span class="n">f_g</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">lons</span><span class="p">)</span>
            <span class="n">f_g</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">lats</span><span class="p">)</span>
            <span class="n">f_g</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_x</span><span class="p">))</span>
            <span class="n">f_g</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_y</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">var</span> <span class="o">==</span> <span class="s2">&quot;altitude&quot;</span><span class="p">:</span>
            <span class="n">field</span><span class="p">[</span><span class="n">field</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">field</span><span class="p">)):</span>
            <span class="n">fill_nan_value</span> <span class="o">=</span> <span class="n">f_g</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s2">&quot;_FillValue&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Field </span><span class="si">%s</span><span class="s2"> got Nan. Fill with: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fill_nan_value</span><span class="p">))</span>
            <span class="n">field</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">field</span><span class="p">))]</span> <span class="o">=</span> <span class="n">fill_nan_value</span>

        <span class="n">f_g</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">f_g</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f_g</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="cryoclim_pseudoobs">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.cryoclim_pseudoobs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cryoclim_pseudoobs</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_cryoclim_pseudoobs</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ cryoclim_pseudoobs ******************&quot;</span><span class="p">)</span>

    <span class="n">fg_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;fg&quot;</span><span class="p">][</span><span class="s2">&quot;filepattern&quot;</span><span class="p">]</span>
    <span class="n">varname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;fg&quot;</span><span class="p">][</span><span class="s2">&quot;varname&quot;</span><span class="p">]</span>
    <span class="n">infiles</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;infiles&quot;</span><span class="p">]</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;thinning&quot;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="n">validtime</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;validtime&quot;</span><span class="p">],</span> <span class="n">offset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;indent&quot;</span><span class="p">]</span>
    <span class="n">laf_threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;laf_threshold&quot;</span><span class="p">]</span>
    <span class="n">cryo_varname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cryo_varname&quot;</span><span class="p">]</span>
    <span class="n">fg_geo</span><span class="p">,</span> <span class="n">validtime</span><span class="p">,</span> <span class="n">grid_snow_fg</span><span class="p">,</span> <span class="n">glafs</span><span class="p">,</span> <span class="n">gelevs</span> <span class="o">=</span> <span class="n">read_first_guess_netcdf_file</span><span class="p">(</span>
        <span class="n">fg_file</span><span class="p">,</span> <span class="n">varname</span>
    <span class="p">)</span>

    <span class="n">grid_perm_snow</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">grid_perm_snow_geo</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;perm_snow&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;perm_snow&quot;</span><span class="p">][</span><span class="s2">&quot;filepattern&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fileformat</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;perm_snow&quot;</span><span class="p">][</span><span class="s2">&quot;inputtype&quot;</span><span class="p">]</span>
        <span class="n">basetime</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;perm_snow&quot;</span><span class="p">][</span><span class="s2">&quot;basetime&quot;</span><span class="p">],</span> <span class="n">offset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fileformat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid_perm_snow</span><span class="p">,</span> <span class="n">grid_perm_snow_geo</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span>
                <span class="n">fileformat</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;perm_snow&quot;</span><span class="p">],</span> <span class="n">basetime</span>
            <span class="p">)</span><span class="o">.</span><span class="n">read_var_field</span><span class="p">(</span><span class="n">validtime</span><span class="p">)</span>

    <span class="n">grid_slope</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">grid_slope_geo</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;slope&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">][</span><span class="s2">&quot;filepattern&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fileformat</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">][</span><span class="s2">&quot;inputtype&quot;</span><span class="p">]</span>
        <span class="n">basetime</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">][</span><span class="s2">&quot;basetime&quot;</span><span class="p">],</span> <span class="n">offset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fileformat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid_slope</span><span class="p">,</span> <span class="n">grid_slope_geo</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span>
                <span class="n">fileformat</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">],</span> <span class="n">basetime</span>
            <span class="p">)</span><span class="o">.</span><span class="n">read_var_field</span><span class="p">(</span><span class="n">validtime</span><span class="p">)</span>

    <span class="n">obs_set</span> <span class="o">=</span> <span class="n">CryoclimObservationSet</span><span class="p">(</span>
        <span class="n">infiles</span><span class="p">,</span>
        <span class="n">validtime</span><span class="p">,</span>
        <span class="n">fg_geo</span><span class="p">,</span>
        <span class="n">grid_snow_fg</span><span class="p">,</span>
        <span class="n">gelevs</span><span class="p">,</span>
        <span class="n">perm_snow</span><span class="o">=</span><span class="n">grid_perm_snow</span><span class="p">,</span>
        <span class="n">perm_snow_geo</span><span class="o">=</span><span class="n">grid_perm_snow_geo</span><span class="p">,</span>
        <span class="n">slope</span><span class="o">=</span><span class="n">grid_slope</span><span class="p">,</span>
        <span class="n">slope_geo</span><span class="o">=</span><span class="n">grid_slope_geo</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
        <span class="n">glaf</span><span class="o">=</span><span class="n">glafs</span><span class="p">,</span>
        <span class="n">laf_threshold</span><span class="o">=</span><span class="n">laf_threshold</span><span class="p">,</span>
        <span class="n">cryo_varname</span><span class="o">=</span><span class="n">cryo_varname</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">obs_set</span><span class="o">.</span><span class="n">write_json_file</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_namelist">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.create_namelist">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_namelist</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: &quot;File not found:&quot;</span>
<span class="sd">        RuntimeError: &quot;Geo is needed for PGD&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_create_namelist</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ </span><span class="si">%s</span><span class="s2"> ******************&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;ARGS: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>

    <span class="n">domain</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;domain&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandler</span><span class="p">:</span>
            <span class="n">geo</span> <span class="o">=</span> <span class="n">get_geo_object</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fhandler</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;pgd&quot;</span> <span class="ow">and</span> <span class="n">geo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Geo is needed for PGD&quot;</span><span class="p">)</span>
    <span class="n">uppercase</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uppercase&quot;</span><span class="p">)</span>
    <span class="n">true_repr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;true_repr&quot;</span><span class="p">)</span>
    <span class="n">false_repr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;false_repr&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">uppercase</span><span class="p">:</span>
        <span class="n">false_repr</span> <span class="o">=</span> <span class="n">false_repr</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">true_repr</span> <span class="o">=</span> <span class="n">true_repr</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">false_repr</span> <span class="o">=</span> <span class="n">false_repr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">true_repr</span> <span class="o">=</span> <span class="n">true_repr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">namelist_defs_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;namelist_defs&quot;</span><span class="p">)</span>
    <span class="n">assemble_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;assemble_file&quot;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;OPTIONS.nam&quot;</span>

    <span class="k">if</span> <span class="n">assemble_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nam_gen</span> <span class="o">=</span> <span class="n">NamelistGeneratorFromNamelistFile</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">namelist_defs_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">namelist_defs_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
            <span class="n">nam_defs</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">assemble_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
            <span class="n">assemble</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
        <span class="n">nam_gen</span> <span class="o">=</span> <span class="n">NamelistGeneratorAssemble</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">nam_defs</span><span class="p">,</span> <span class="n">assemble</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">geo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nam_gen</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">update_namelist</span><span class="p">(</span><span class="n">nam_gen</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="n">nam_gen</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">uppercase</span><span class="o">=</span><span class="n">uppercase</span><span class="p">,</span> <span class="n">true_repr</span><span class="o">=</span><span class="n">true_repr</span><span class="p">,</span> <span class="n">false_repr</span><span class="o">=</span><span class="n">false_repr</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_lsm_file_assim">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.create_lsm_file_assim">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_lsm_file_assim</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: Domain file not found</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_lsm_file_assim</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ create_lsm_fil ******************&quot;</span><span class="p">)</span>

    <span class="n">domain</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;domain&quot;</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;domain=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandler</span><span class="p">:</span>
            <span class="n">domain_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fhandler</span><span class="p">)</span>
        <span class="n">geo</span> <span class="o">=</span> <span class="n">get_geo_object</span><span class="p">(</span><span class="n">domain_json</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
    <span class="n">validtime</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;basetime&quot;</span><span class="p">])</span>

    <span class="c1"># TODO Move to a method outside cli</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span>
    <span class="n">inputfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span>
    <span class="n">fileformat</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;fileformat&quot;</span><span class="p">]</span>
    <span class="n">converter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;converter&quot;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">]</span>

    <span class="n">defs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;filepattern&quot;</span><span class="p">:</span> <span class="n">inputfile</span><span class="p">,</span>
        <span class="s2">&quot;fileformat&quot;</span><span class="p">:</span> <span class="n">fileformat</span><span class="p">,</span>
        <span class="s2">&quot;filetype&quot;</span><span class="p">:</span> <span class="s2">&quot;surf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fcint&quot;</span><span class="p">:</span> <span class="mi">10800</span><span class="p">,</span>
        <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">fileformat</span><span class="p">)</span>
    <span class="n">converter_conf</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;none&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">var</span><span class="p">,</span> <span class="s2">&quot;varname&quot;</span><span class="p">:</span> <span class="n">var</span><span class="p">}}</span>

    <span class="n">var</span> <span class="o">=</span> <span class="s2">&quot;LSM&quot;</span>
    <span class="n">initial_basetime</span> <span class="o">=</span> <span class="n">validtime</span> <span class="o">-</span> <span class="n">as_timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">10800</span><span class="p">)</span>
    <span class="n">converter</span> <span class="o">=</span> <span class="n">Converter</span><span class="p">(</span><span class="n">converter</span><span class="p">,</span> <span class="n">initial_basetime</span><span class="p">,</span> <span class="n">defs</span><span class="p">,</span> <span class="n">converter_conf</span><span class="p">,</span> <span class="n">fileformat</span><span class="p">)</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">ConvertedInput</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">converter</span><span class="p">)</span><span class="o">.</span><span class="n">read_time_step</span><span class="p">(</span><span class="n">validtime</span><span class="p">,</span> <span class="n">cache</span><span class="p">)</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="p">[</span><span class="n">geo</span><span class="o">.</span><span class="n">nlons</span><span class="p">,</span> <span class="n">geo</span><span class="o">.</span><span class="n">nlats</span><span class="p">])</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">nlats</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">nlons</span><span class="p">):</span>
                <span class="n">file_handler</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_forcing">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.create_forcing">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_forcing</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_create_forcing</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ create_forcing ******************&quot;</span><span class="p">)</span>
    <span class="n">options</span><span class="p">,</span> <span class="n">var_objs</span><span class="p">,</span> <span class="n">att_objs</span> <span class="o">=</span> <span class="n">set_forcing_config</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">run_time_loop</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">var_objs</span><span class="p">,</span> <span class="n">att_objs</span><span class="p">)</span></div>



<div class="viewcode-block" id="bufr2json">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.bufr2json">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bufr2json</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_bufr2json</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ bufr2json ******************&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;This method is depreciated. Please use create_obsset_file&quot;</span><span class="p">)</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vars&quot;</span><span class="p">)</span>
    <span class="n">bufrfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bufr&quot;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
    <span class="n">valid_dtg</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;obs_time&quot;</span><span class="p">))</span>
    <span class="n">valid_range</span> <span class="o">=</span> <span class="n">as_timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;valid_range&quot;</span><span class="p">))</span>
    <span class="n">sigmao</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sigmao&quot;</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indent&quot;</span><span class="p">)</span>
    <span class="n">lonrange</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lonrange&quot;</span><span class="p">)</span>
    <span class="n">latrange</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latrange&quot;</span><span class="p">)</span>

    <span class="n">create_obsset_file</span><span class="p">(</span>
        <span class="n">valid_dtg</span><span class="p">,</span>
        <span class="s2">&quot;bufr&quot;</span><span class="p">,</span>
        <span class="n">variables</span><span class="p">,</span>
        <span class="n">bufrfile</span><span class="p">,</span>
        <span class="n">output</span><span class="p">,</span>
        <span class="n">pos_t_range</span><span class="o">=</span><span class="n">valid_range</span><span class="p">,</span>
        <span class="n">lonrange</span><span class="o">=</span><span class="n">lonrange</span><span class="p">,</span>
        <span class="n">latrange</span><span class="o">=</span><span class="n">latrange</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span>
        <span class="n">sigmao</span><span class="o">=</span><span class="n">sigmao</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="obs2json">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.obs2json">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">obs2json</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_obs2json</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ obs2json ******************&quot;</span><span class="p">)</span>
    <span class="n">obs_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;obs_type&quot;</span><span class="p">)</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vars&quot;</span><span class="p">)</span>
    <span class="n">inputfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputfile&quot;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
    <span class="n">obs_time</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;obs_time&quot;</span><span class="p">))</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">)</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">)</span>
    <span class="n">obtypes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;obtypes&quot;</span><span class="p">)</span>
    <span class="n">subtypes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subtypes&quot;</span><span class="p">)</span>
    <span class="n">sigmao</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sigmao&quot;</span><span class="p">)</span>
    <span class="n">pos_t_range</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pos_t_range&quot;</span><span class="p">)</span>
    <span class="n">neg_t_range</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;neg_t_range&quot;</span><span class="p">)</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indent&quot;</span><span class="p">)</span>
    <span class="n">lonrange</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lonrange&quot;</span><span class="p">)</span>
    <span class="n">latrange</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latrange&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pos_t_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pos_t_range</span> <span class="o">=</span> <span class="n">as_timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">pos_t_range</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">neg_t_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">neg_t_range</span> <span class="o">=</span> <span class="n">as_timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">neg_t_range</span><span class="p">)</span>

    <span class="n">create_obsset_file</span><span class="p">(</span>
        <span class="n">obs_time</span><span class="p">,</span>
        <span class="n">obs_type</span><span class="p">,</span>
        <span class="n">variables</span><span class="p">,</span>
        <span class="n">inputfile</span><span class="p">,</span>
        <span class="n">output</span><span class="p">,</span>
        <span class="n">pos_t_range</span><span class="o">=</span><span class="n">pos_t_range</span><span class="p">,</span>
        <span class="n">neg_t_range</span><span class="o">=</span><span class="n">neg_t_range</span><span class="p">,</span>
        <span class="n">lonrange</span><span class="o">=</span><span class="n">lonrange</span><span class="p">,</span>
        <span class="n">latrange</span><span class="o">=</span><span class="n">latrange</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span>
        <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span>
        <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span>
        <span class="n">obtypes</span><span class="o">=</span><span class="n">obtypes</span><span class="p">,</span>
        <span class="n">subtypes</span><span class="o">=</span><span class="n">subtypes</span><span class="p">,</span>
        <span class="n">sigmao</span><span class="o">=</span><span class="n">sigmao</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="cli_set_domain_from_harmonie">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.cli_set_domain_from_harmonie">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cli_set_domain_from_harmonie</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: File not found</span>
<span class="sd">        RuntimeError: Domain not provided</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_set_domain</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ set_domain_from_harmonie ******************&quot;</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">output</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">indent</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="n">ConfProjFromHarmonie</span><span class="p">()</span>
    <span class="n">domain_json</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">json</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">domain_json</span><span class="p">,</span> <span class="n">file_handler</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span></div>



<div class="viewcode-block" id="cli_set_geo_from_obs_set">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.cli_set_geo_from_obs_set">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cli_set_geo_from_obs_set</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_set_geo_from_obs_set</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ set_geo_from_obs_set ******************&quot;</span><span class="p">)</span>

    <span class="n">validtime</span> <span class="o">=</span> <span class="n">as_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;validtime&quot;</span><span class="p">])</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="n">set_geo_from_obs_set</span><span class="p">(</span>
        <span class="n">validtime</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;obs_type&quot;</span><span class="p">],</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">],</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;inputfile&quot;</span><span class="p">],</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;lonrange&quot;</span><span class="p">],</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;latrange&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">json</span><span class="p">,</span> <span class="n">file_handler</span><span class="p">)</span></div>



<div class="viewcode-block" id="cli_set_geo_from_stationlist">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.cli_set_geo_from_stationlist">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cli_set_geo_from_stationlist</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_set_geo_from_stationlist</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ set_geo_from_stationlist ******************&quot;</span><span class="p">)</span>
    <span class="n">geo</span> <span class="o">=</span> <span class="n">set_geo_from_stationlist</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">json</span><span class="p">,</span> <span class="n">file_handler</span><span class="p">)</span></div>



<div class="viewcode-block" id="cli_shape2ign">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.cli_shape2ign">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cli_shape2ign</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_shape2ign</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ shape2ign ******************&quot;</span><span class="p">)</span>
    <span class="n">catchment</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;catchment&quot;</span><span class="p">)</span>
    <span class="n">infile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;infile&quot;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indent&quot;</span><span class="p">)</span>
    <span class="n">ref_proj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ref_proj&quot;</span><span class="p">)</span>

    <span class="n">shape2ign</span><span class="p">(</span><span class="n">catchment</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">ref_proj</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span></div>



<div class="viewcode-block" id="soda">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.soda">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">soda</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_surfex_binary</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="s2">&quot;soda&quot;</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ soda ******************&quot;</span><span class="p">)</span>
    <span class="n">run_surfex_binary</span><span class="p">(</span><span class="s2">&quot;soda&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="titan">
<a class="viewcode-back" href="../../index.html#pysurfex.cli.titan">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">titan</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface.</span>

<span class="sd">    Args:</span>
<span class="sd">        argv(list, optional): Arguments. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_args_titan</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(pathname)s</span><span class="s2">:</span><span class="si">%(lineno)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;************ titan ******************&quot;</span><span class="p">)</span>
    <span class="n">run_titan</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SURFEX Python API (pysurfex)  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pysurfex.cli</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2020, Trygve Aspelien.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>